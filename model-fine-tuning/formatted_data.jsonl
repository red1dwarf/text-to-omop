{"input": "Use the OMOP schema below to write an SQL query for the question. Only print a valid SQL query; do not include any explanations or additional text.\n\nQuestion: \"What are the top 4 frequent prescribed drugs for patients who were also prescribed drug_concept_id 19041823 at the same time on the last hospital visit?\"\n\nRelevant Schema:\n-- Schema for table: drug_exposure\ndrug_exposure.drug_exposure_id: Unique ID for the drug exposure record\ndrug_exposure.person_id: Foreign key to person table\ndrug_exposure.drug_concept_id: Concept ID of the prescribed drug\ndrug_exposure.drug_exposure_start_date: Start date of drug exposure\n\n\nSQL:\n", "output": "WITH last_visits AS (\n SELECT person_id, MAX(visit_occurrence_id) AS last_visit_id\n FROM drug_exposure\n GROUP BY person_id\n),\ntarget_patients_dates AS (\n SELECT DISTINCT person_id, visit_occurrence_id, drug_exposure_start_date\n FROM drug_exposure\n WHERE drug_concept_id = 19041823\n AND (person_id, visit_occurrence_id) IN (\n SELECT person_id, last_visit_id FROM last_visits\n )\n),\ndrugs_same_time AS (\n SELECT drug_concept_id\n FROM drug_exposure\n WHERE (person_id, visit_occurrence_id, drug_exposure_start_date) IN (\n SELECT person_id, visit_occurrence_id, drug_exposure_start_date FROM target_patients_dates\n )\n)\nSELECT drug_concept_id, COUNT(*) AS freq\nFROM drugs_same_time\nWHERE drug_concept_id != 0\nGROUP BY drug_concept_id\nORDER BY freq DESC\nLIMIT 4;"}
{"input": "Use the OMOP schema below to write an SQL query for the question. Only print a valid SQL query; do not include any explanations or additional text.\n\nQuestion: \"What are the top 3 frequent prescribed drugs for patients who were also prescribed 711586 within the same hospital visit on the first hospital visit?\"\n\nRelevant Schema:\n-- Schema for table: drug_exposure\ndrug_exposure.drug_exposure_id: Unique ID for the drug exposure record\ndrug_exposure.person_id: Foreign key to person table\ndrug_exposure.drug_concept_id: Concept ID of the prescribed drug\ndrug_exposure.drug_exposure_start_date: Start date of drug exposure\n\n\nSQL:\n", "output": "WITH first_visits AS (\n SELECT person_id, MIN(visit_occurrence_id) AS first_visit_id\n FROM drug_exposure\n GROUP BY person_id\n),\npatients_with_711586 AS (\n SELECT DISTINCT person_id, visit_occurrence_id\n FROM drug_exposure\n WHERE drug_concept_id = 711586\n),\ntarget_visits AS (\n SELECT fv.person_id, fv.first_visit_id AS visit_occurrence_id\n FROM first_visits fv\n WHERE EXISTS (\n SELECT 1\n FROM patients_with_711586 pw\n WHERE pw.person_id = fv.person_id\n AND pw.visit_occurrence_id = fv.first_visit_id\n )\n),\ndrugs_in_target_visits AS (\n SELECT drug_concept_id\n FROM drug_exposure\n WHERE (person_id, visit_occurrence_id) IN (\n SELECT person_id, visit_occurrence_id FROM target_visits\n )\n)\nSELECT drug_concept_id, COUNT(*) AS freq\nFROM drugs_in_target_visits\nWHERE drug_concept_id != 0\nGROUP BY drug_concept_id\nORDER BY freq DESC\nLIMIT 3;"}
{"input": "Use the OMOP schema below to write an SQL query for the question. Only print a valid SQL query; do not include any explanations or additional text.\n\nQuestion: \"What are the top 3 frequent prescribed drugs for patients who were also prescribed drug_concept_id 40220388 within the same month since July/2167?\"\n\nRelevant Schema:\n-- Schema for table: drug_exposure\ndrug_exposure.drug_exposure_id: Unique ID for the drug exposure record\ndrug_exposure.person_id: Foreign key to person table\ndrug_exposure.drug_concept_id: Concept ID of the prescribed drug\ndrug_exposure.drug_exposure_start_date: Start date of drug exposure\n\n\nSQL:\n", "output": "WITH target_patients_months AS (\n SELECT DISTINCT person_id,\n EXTRACT(YEAR FROM drug_exposure_start_date) AS yr,\n EXTRACT(MONTH FROM drug_exposure_start_date) AS mo\n FROM drug_exposure\n WHERE drug_concept_id = 40220388\n AND drug_exposure_start_date >= '2167-07-01'\n),\ndrugs_in_same_month AS (\n SELECT drug_concept_id\n FROM drug_exposure\n WHERE (person_id, EXTRACT(YEAR FROM drug_exposure_start_date), EXTRACT(MONTH FROM drug_exposure_start_date)) IN (\n SELECT person_id, yr, mo FROM target_patients_months\n )\n)\nSELECT drug_concept_id, COUNT(*) AS freq\nFROM drugs_in_same_month\nWHERE drug_concept_id != 0\nGROUP BY drug_concept_id\nORDER BY freq DESC\nLIMIT 3;"}
{"input": "Use the OMOP schema below to write an SQL query for the question. Only print a valid SQL query; do not include any explanations or additional text.\n\nQuestion: \"What are the top 5 frequent prescribed drugs for patients who were also prescribed drug_concept_id 19127213 within the same day last year?\"\n\nRelevant Schema:\n-- Schema for table: drug_exposure\ndrug_exposure.drug_exposure_id: Unique ID for the drug exposure record\ndrug_exposure.person_id: Foreign key to person table\ndrug_exposure.drug_concept_id: Concept ID of the prescribed drug\ndrug_exposure.drug_exposure_start_date: Start date of drug exposure\n\n\nSQL:\n", "output": "WITH target_patients_days AS (\n SELECT DISTINCT person_id, drug_exposure_start_date\n FROM drug_exposure\n WHERE drug_concept_id = 19127213\n AND EXTRACT(YEAR FROM drug_exposure_start_date) = EXTRACT(YEAR FROM CURRENT_DATE) - 1\n),\ndrugs_in_same_day AS (\n SELECT drug_concept_id\n FROM drug_exposure\n WHERE (person_id, drug_exposure_start_date) IN (\n SELECT person_id, drug_exposure_start_date FROM target_patients_days\n )\n)\nSELECT drug_concept_id, COUNT(*) AS freq\nFROM drugs_in_same_day\nWHERE drug_concept_id != 0\nGROUP BY drug_concept_id\nORDER BY freq DESC\nLIMIT 5;"}
{"input": "Use the OMOP schema below to write an SQL query for the question. Only print a valid SQL query; do not include any explanations or additional text.\n\nQuestion: \"What are the top 3 frequent prescribed drugs for patients who were also prescribed drug_concept_id 19135374 within 2 year until January/last year?\"\n\nRelevant Schema:\n-- Schema for table: drug_exposure\ndrug_exposure.drug_exposure_id: Unique ID for the drug exposure record\ndrug_exposure.person_id: Foreign key to person table\ndrug_exposure.drug_concept_id: Concept ID of the prescribed drug\ndrug_exposure.drug_exposure_start_date: Start date of drug exposure\n\n\nSQL:\n", "output": "WITH params AS (\n SELECT \n make_date(EXTRACT(YEAR FROM CURRENT_DATE)::int - 1, 1, 1) AS window_end,\n make_date(EXTRACT(YEAR FROM CURRENT_DATE)::int - 1, 1, 1) - interval '2 years' AS window_start\n),\ntarget_patients AS (\n SELECT DISTINCT person_id\n FROM drug_exposure, params\n WHERE drug_concept_id = 19135374\n AND drug_exposure_start_date >= params.window_start\n AND drug_exposure_start_date < params.window_end\n),\ndrugs_in_window AS (\n SELECT drug_concept_id\n FROM drug_exposure\n WHERE person_id IN (SELECT person_id FROM target_patients)\n AND drug_exposure_start_date >= (SELECT window_start FROM params)\n AND drug_exposure_start_date < (SELECT window_end FROM params)\n)\nSELECT drug_concept_id, COUNT(*) AS freq\nFROM drugs_in_window\nWHERE drug_concept_id != 0\nGROUP BY drug_concept_id\nORDER BY freq DESC\nLIMIT 3;"}
{"input": "Use the OMOP schema below to write an SQL query for the question. Only print a valid SQL query; do not include any explanations or additional text.\n\nQuestion: \"what are the top 3 frequent diagnoses of patients aged 60's or above last month?\"\n\nRelevant Schema:\n-- Schema for table: condition_occurrence\ncondition_occurrence.condition_occurrence_id: Unique ID for condition record\ncondition_occurrence.person_id: Foreign key to person table\ncondition_occurrence.condition_concept_id: Concept ID for condition\ncondition_occurrence.condition_start_date: Date of condition onset\n\n-- Schema for table: person\nperson.person_id: Unique identifier for each patient\nperson.year_of_birth: Year of birth of the person\nperson.gender_concept_id: Gender as concept ID\nperson.race_concept_id: Race as concept ID\n\n\nSQL:\n", "output": "SELECT condition_concept_id, COUNT(*) AS diagnosis_count\nFROM condition_occurrence\nWHERE condition_start_date >= date_trunc('month', CURRENT_DATE - INTERVAL '1 month')\n  AND condition_start_date < date_trunc('month', CURRENT_DATE)\n  AND person_id IN (SELECT person_id FROM person WHERE EXTRACT(YEAR FROM AGE(CURRENT_DATE, make_date(year_of_birth, 1, 1))) >= 60)\nGROUP BY condition_concept_id\nORDER BY diagnosis_count DESC\nLIMIT 3;"}
{"input": "Use the OMOP schema below to write an SQL query for the question. Only print a valid SQL query; do not include any explanations or additional text.\n\nQuestion: \"what were the top 3 frequent diagnoses of patients aged 40's until 2189?\"\n\nRelevant Schema:\n-- Schema for table: condition_occurrence\ncondition_occurrence.condition_occurrence_id: Unique ID for condition record\ncondition_occurrence.person_id: Foreign key to person table\ncondition_occurrence.condition_concept_id: Concept ID for condition\ncondition_occurrence.condition_start_date: Date of condition onset\n\n-- Schema for table: person\nperson.person_id: Unique identifier for each patient\nperson.year_of_birth: Year of birth of the person\nperson.gender_concept_id: Gender as concept ID\nperson.race_concept_id: Race as concept ID\n\n\nSQL:\n", "output": "SELECT condition_concept_id, COUNT(*) AS diagnosis_count\nFROM condition_occurrence\nWHERE condition_start_date < '2190-01-01'\n  AND person_id IN (SELECT person_id FROM person WHERE EXTRACT(YEAR FROM AGE('2189-12-31', make_date(year_of_birth, 1, 1))) BETWEEN 40 AND 49)\nGROUP BY condition_concept_id\nORDER BY diagnosis_count DESC\nLIMIT 3;"}
{"input": "Use the OMOP schema below to write an SQL query for the question. Only print a valid SQL query; do not include any explanations or additional text.\n\nQuestion: \"what were the top 5 frequent diagnoses of patients aged 50's on the current ICU visit?\"\n\nRelevant Schema:\n-- Schema for table: condition_occurrence\ncondition_occurrence.condition_occurrence_id: Unique ID for condition record\ncondition_occurrence.person_id: Foreign key to person table\ncondition_occurrence.condition_concept_id: Concept ID for condition\ncondition_occurrence.condition_start_date: Date of condition onset\n\n-- Schema for table: person\nperson.person_id: Unique identifier for each patient\nperson.year_of_birth: Year of birth of the person\nperson.gender_concept_id: Gender as concept ID\nperson.race_concept_id: Race as concept ID\n\n-- Schema for table: visit_occurrence\nvisit_occurrence.visit_occurrence_id: Unique ID for visit record\nvisit_occurrence.person_id: Foreign key to person table\nvisit_occurrence.visit_concept_id: Concept ID for type of visit (e.g., outpatient, inpatient)\nvisit_occurrence.visit_start_date: Date when the visit started\n\n\nSQL:\n", "output": "SELECT condition_concept_id, COUNT(*) AS diagnosis_count\nFROM condition_occurrence\nWHERE visit_occurrence_id = (SELECT MAX(visit_occurrence_id) FROM visit_occurrence WHERE visit_concept_id IN (9203, 32037, 44818517))\n  AND person_id IN (SELECT person_id FROM person WHERE EXTRACT(YEAR FROM AGE(CURRENT_DATE, make_date(year_of_birth, 1, 1))) BETWEEN 50 AND 59)\nGROUP BY condition_concept_id\nORDER BY diagnosis_count DESC\nLIMIT 5;"}
{"input": "Use the OMOP schema below to write an SQL query for the question. Only print a valid SQL query; do not include any explanations or additional text.\n\nQuestion: \"what were the top 3 frequent diagnoses of patients aged 20's on March/12/2201?\"\n\nRelevant Schema:\n-- Schema for table: condition_occurrence\ncondition_occurrence.condition_occurrence_id: Unique ID for condition record\ncondition_occurrence.person_id: Foreign key to person table\ncondition_occurrence.condition_concept_id: Concept ID for condition\ncondition_occurrence.condition_start_date: Date of condition onset\n\n-- Schema for table: person\nperson.person_id: Unique identifier for each patient\nperson.year_of_birth: Year of birth of the person\nperson.gender_concept_id: Gender as concept ID\nperson.race_concept_id: Race as concept ID\n\n\nSQL:\n", "output": "SELECT condition_concept_id, COUNT(*) AS diagnosis_count\nFROM condition_occurrence\nWHERE condition_start_date = '2201-03-12'\n  AND person_id IN (SELECT person_id FROM person WHERE EXTRACT(YEAR FROM AGE('2201-03-12', make_date(year_of_birth, 1, 1))) BETWEEN 20 AND 29)\nGROUP BY condition_concept_id\nORDER BY diagnosis_count DESC\nLIMIT 3;"}
{"input": "Use the OMOP schema below to write an SQL query for the question. Only print a valid SQL query; do not include any explanations or additional text.\n\nQuestion: \"what are the top 4 frequent diagnoses of patients aged 60's or above until 4 month ago?\"\n\nRelevant Schema:\n-- Schema for table: condition_occurrence\ncondition_occurrence.condition_occurrence_id: Unique ID for condition record\ncondition_occurrence.person_id: Foreign key to person table\ncondition_occurrence.condition_concept_id: Concept ID for condition\ncondition_occurrence.condition_start_date: Date of condition onset\n\n-- Schema for table: person\nperson.person_id: Unique identifier for each patient\nperson.year_of_birth: Year of birth of the person\nperson.gender_concept_id: Gender as concept ID\nperson.race_concept_id: Race as concept ID\n\n\nSQL:\n", "output": "SELECT condition_concept_id, COUNT(*) AS diagnosis_count\nFROM condition_occurrence\nWHERE condition_start_date < date_trunc('month', CURRENT_DATE) - INTERVAL '4 months'\n  AND person_id IN (SELECT person_id FROM person WHERE EXTRACT(YEAR FROM AGE(CURRENT_DATE, make_date(year_of_birth, 1, 1))) >= 60)\nGROUP BY condition_concept_id\nORDER BY diagnosis_count DESC\nLIMIT 4;"}
{"input": "Use the OMOP schema below to write an SQL query for the question. Only print a valid SQL query; do not include any explanations or additional text.\n\nQuestion: \"What percentile is the value of 1.3 in a 3022217 lab test among patients of the same age as patient 4924550704026979905 in March/last year?\"\n\nRelevant Schema:\n-- Schema for table: measurement\nmeasurement.measurement_id: Unique ID for measurement record\nmeasurement.person_id: Foreign key to person table\nmeasurement.measurement_concept_id: Concept ID for the measurement (e.g., blood pressure)\nmeasurement.measurement_date: Date of the measurement\n\n-- Schema for table: person\nperson.person_id: Unique identifier for each patient\nperson.year_of_birth: Year of birth of the person\nperson.gender_concept_id: Gender as concept ID\nperson.race_concept_id: Race as concept ID\n\n\nSQL:\n", "output": "WITH patient_birth_year AS (SELECT year_of_birth FROM person WHERE person_id = 4924550704026979905), filtered_measurements AS (SELECT value_as_number FROM measurement WHERE measurement_concept_id = 3022217 AND EXTRACT(YEAR FROM measurement_date) = EXTRACT(YEAR FROM CURRENT_DATE) - 1 AND EXTRACT(MONTH FROM measurement_date) = 3 AND person_id IN (SELECT person_id FROM person WHERE year_of_birth = (SELECT year_of_birth FROM patient_birth_year)) AND value_as_number IS NOT NULL), ranked_values AS (SELECT value_as_number, PERCENT_RANK() OVER (ORDER BY value_as_number) AS percentile FROM filtered_measurements) SELECT percentile FROM ranked_values WHERE value_as_number = 1.3 LIMIT 1;"}
{"input": "Use the OMOP schema below to write an SQL query for the question. Only print a valid SQL query; do not include any explanations or additional text.\n\nQuestion: \"What percentile is the value of 98.5 in a 3020891 lab test among patients of the same age as patient -3165460829936440061 since last year?\"\n\nRelevant Schema:\n-- Schema for table: measurement\nmeasurement.measurement_id: Unique ID for measurement record\nmeasurement.person_id: Foreign key to person table\nmeasurement.measurement_concept_id: Concept ID for the measurement (e.g., blood pressure)\nmeasurement.measurement_date: Date of the measurement\n\n-- Schema for table: person\nperson.person_id: Unique identifier for each patient\nperson.year_of_birth: Year of birth of the person\nperson.gender_concept_id: Gender as concept ID\nperson.race_concept_id: Race as concept ID\n\n\nSQL:\n", "output": "WITH patient_birth_year AS (SELECT year_of_birth FROM person WHERE person_id = -3165460829936440061), filtered_measurements AS (SELECT value_as_number FROM measurement WHERE measurement_concept_id = 3020891 AND measurement_date >= (DATE_TRUNC('year', CURRENT_DATE) - INTERVAL '1 year') AND person_id IN (SELECT person_id FROM person WHERE year_of_birth = (SELECT year_of_birth FROM patient_birth_year)) AND value_as_number IS NOT NULL), ranked_values AS (SELECT value_as_number, PERCENT_RANK() OVER (ORDER BY value_as_number) AS percentile FROM filtered_measurements) SELECT percentile FROM ranked_values WHERE value_as_number = 98.5 LIMIT 1;"}
{"input": "Use the OMOP schema below to write an SQL query for the question. Only print a valid SQL query; do not include any explanations or additional text.\n\nQuestion: \"What percentile is the value of 59.0 in a 3027018 lab test among patients of the same age as patient 987285437032398862 on the last hospital visit?\"\n\nRelevant Schema:\n-- Schema for table: measurement\nmeasurement.measurement_id: Unique ID for measurement record\nmeasurement.person_id: Foreign key to person table\nmeasurement.measurement_concept_id: Concept ID for the measurement (e.g., blood pressure)\nmeasurement.measurement_date: Date of the measurement\n\n-- Schema for table: person\nperson.person_id: Unique identifier for each patient\nperson.year_of_birth: Year of birth of the person\nperson.gender_concept_id: Gender as concept ID\nperson.race_concept_id: Race as concept ID\n\n-- Schema for table: visit_occurrence\nvisit_occurrence.visit_occurrence_id: Unique ID for visit record\nvisit_occurrence.person_id: Foreign key to person table\nvisit_occurrence.visit_concept_id: Concept ID for type of visit (e.g., outpatient, inpatient)\nvisit_occurrence.visit_start_date: Date when the visit started\n\n\nSQL:\n", "output": "WITH patient_birth_year AS (SELECT year_of_birth FROM person WHERE person_id = 987285437032398862), last_visit_id AS (SELECT visit_occurrence_id FROM visit_occurrence WHERE person_id = 987285437032398862 ORDER BY visit_start_date DESC LIMIT 1), patients_same_birth_year AS (SELECT person_id FROM person WHERE year_of_birth = (SELECT year_of_birth FROM patient_birth_year)), last_visits_same_birth_year AS (SELECT person_id, visit_occurrence_id FROM visit_occurrence WHERE visit_occurrence_id IN (SELECT visit_occurrence_id FROM visit_occurrence v2 WHERE v2.person_id = visit_occurrence.person_id ORDER BY v2.visit_start_date DESC LIMIT 1) AND person_id IN (SELECT person_id FROM patients_same_birth_year)), filtered_measurements AS (SELECT value_as_number FROM measurement WHERE measurement_concept_id = 3027018 AND visit_occurrence_id IN (SELECT visit_occurrence_id FROM last_visits_same_birth_year) AND value_as_number IS NOT NULL), ranked_values AS (SELECT value_as_number, PERCENT_RANK() OVER (ORDER BY value_as_number) AS percentile FROM filtered_measurements) SELECT percentile FROM ranked_values WHERE value_as_number = 59.0 LIMIT 1;"}
{"input": "Use the OMOP schema below to write an SQL query for the question. Only print a valid SQL query; do not include any explanations or additional text.\n\nQuestion: \"What percentile is the value of 14.8 in a 3019897 lab test among patients of the same age as patient 3158857548412946003 since last month?\"\n\nRelevant Schema:\n-- Schema for table: measurement\nmeasurement.measurement_id: Unique ID for measurement record\nmeasurement.person_id: Foreign key to person table\nmeasurement.measurement_concept_id: Concept ID for the measurement (e.g., blood pressure)\nmeasurement.measurement_date: Date of the measurement\n\n-- Schema for table: person\nperson.person_id: Unique identifier for each patient\nperson.year_of_birth: Year of birth of the person\nperson.gender_concept_id: Gender as concept ID\nperson.race_concept_id: Race as concept ID\n\n\nSQL:\n", "output": "WITH patient_birth_year AS (SELECT year_of_birth FROM person WHERE person_id = 3158857548412946003), filtered_measurements AS (SELECT value_as_number FROM measurement WHERE measurement_concept_id = 3019897 AND measurement_date >= (DATE_TRUNC('month', CURRENT_DATE) - INTERVAL '1 month') AND person_id IN (SELECT person_id FROM person WHERE year_of_birth = (SELECT year_of_birth FROM patient_birth_year)) AND value_as_number IS NOT NULL), ranked_values AS (SELECT value_as_number, PERCENT_RANK() OVER (ORDER BY value_as_number) AS percentile FROM filtered_measurements) SELECT percentile FROM ranked_values WHERE value_as_number = 14.8 LIMIT 1;"}
{"input": "Use the OMOP schema below to write an SQL query for the question. Only print a valid SQL query; do not include any explanations or additional text.\n\nQuestion: \"What percentile is the value of 4.0 in a 3035206 lab test among patients of the same age as patient -8623393892246627034 until yesterday?\"\n\nRelevant Schema:\n-- Schema for table: measurement\nmeasurement.measurement_id: Unique ID for measurement record\nmeasurement.person_id: Foreign key to person table\nmeasurement.measurement_concept_id: Concept ID for the measurement (e.g., blood pressure)\nmeasurement.measurement_date: Date of the measurement\n\n-- Schema for table: person\nperson.person_id: Unique identifier for each patient\nperson.year_of_birth: Year of birth of the person\nperson.gender_concept_id: Gender as concept ID\nperson.race_concept_id: Race as concept ID\n\n\nSQL:\n", "output": "WITH patient_birth_year AS (SELECT year_of_birth FROM person WHERE person_id = -8623393892246627034), filtered_measurements AS (SELECT value_as_number FROM measurement WHERE measurement_concept_id = 3035206 AND measurement_date < CURRENT_DATE AND person_id IN (SELECT person_id FROM person WHERE year_of_birth = (SELECT year_of_birth FROM patient_birth_year)) AND value_as_number IS NOT NULL), ranked_values AS (SELECT value_as_number, PERCENT_RANK() OVER (ORDER BY value_as_number) AS percentile FROM filtered_measurements) SELECT percentile FROM ranked_values WHERE value_as_number = 4.0 LIMIT 1;"}
{"input": "Use the OMOP schema below to write an SQL query for the question. Only print a valid SQL query; do not include any explanations or additional text.\n\nQuestion: \"What was the name of the drug that patient -449512254961891092 was at 2145-09-19 20:00:00 prescribed via route 4142048 yesterday?\"\n\nRelevant Schema:\n-- Schema for table: concept\nconcept.concept_id: Unique concept identifier across vocabularies\nconcept.concept_name: Human-readable name of the concept\nconcept.domain_id: Domain classification (e.g., Condition, Drug, Measurement)\nconcept.vocabulary_id: Vocabulary source (e.g., SNOMED, RxNorm)\n\n-- Schema for table: drug_exposure\ndrug_exposure.drug_exposure_id: Unique ID for the drug exposure record\ndrug_exposure.person_id: Foreign key to person table\ndrug_exposure.drug_concept_id: Concept ID of the prescribed drug\ndrug_exposure.drug_exposure_start_date: Start date of drug exposure\n\n\nSQL:\n", "output": "SELECT concept_name FROM concept WHERE concept_id = (SELECT drug_concept_id FROM drug_exposure WHERE person_id = -449512254961891092 AND exposure_start_datetime = TIMESTAMP '2145-09-19 20:00:00' AND route_concept_id = 4142048 AND exposure_start_date < CURRENT_DATE AND drug_concept_id IS NOT NULL LIMIT 1) LIMIT 1;"}
{"input": "Use the OMOP schema below to write an SQL query for the question. Only print a valid SQL query; do not include any explanations or additional text.\n\nQuestion: \"What was the name of the drug that patient -3201959312032121892 was last prescribed via route 40486069 since yesterday?\"\n\nRelevant Schema:\n-- Schema for table: concept\nconcept.concept_id: Unique concept identifier across vocabularies\nconcept.concept_name: Human-readable name of the concept\nconcept.domain_id: Domain classification (e.g., Condition, Drug, Measurement)\nconcept.vocabulary_id: Vocabulary source (e.g., SNOMED, RxNorm)\n\n-- Schema for table: drug_exposure\ndrug_exposure.drug_exposure_id: Unique ID for the drug exposure record\ndrug_exposure.person_id: Foreign key to person table\ndrug_exposure.drug_concept_id: Concept ID of the prescribed drug\ndrug_exposure.drug_exposure_start_date: Start date of drug exposure\n\n\nSQL:\n", "output": "SELECT concept_name FROM concept WHERE concept_id = (SELECT drug_concept_id FROM (SELECT drug_concept_id FROM drug_exposure WHERE person_id = -3201959312032121892 AND route_concept_id = 40486069 AND exposure_start_date >= CURRENT_DATE - INTERVAL '1 day' AND drug_concept_id IS NOT NULL ORDER BY exposure_start_datetime DESC LIMIT 1) AS last_prescription) LIMIT 1;"}
{"input": "Use the OMOP schema below to write an SQL query for the question. Only print a valid SQL query; do not include any explanations or additional text.\n\nQuestion: \"What was the name of the drug that patient -4199078057453045236 was second to last prescribed via route 4262914 until last month?\"\n\nRelevant Schema:\n-- Schema for table: concept\nconcept.concept_id: Unique concept identifier across vocabularies\nconcept.concept_name: Human-readable name of the concept\nconcept.domain_id: Domain classification (e.g., Condition, Drug, Measurement)\nconcept.vocabulary_id: Vocabulary source (e.g., SNOMED, RxNorm)\n\n-- Schema for table: drug_exposure\ndrug_exposure.drug_exposure_id: Unique ID for the drug exposure record\ndrug_exposure.person_id: Foreign key to person table\ndrug_exposure.drug_concept_id: Concept ID of the prescribed drug\ndrug_exposure.drug_exposure_start_date: Start date of drug exposure\n\n\nSQL:\n", "output": "SELECT concept_name FROM concept WHERE concept_id = (SELECT drug_concept_id FROM (SELECT drug_concept_id FROM drug_exposure WHERE person_id = -4199078057453045236 AND route_concept_id = 4262914 AND exposure_start_date < DATE_TRUNC('month', CURRENT_DATE) AND drug_concept_id IS NOT NULL ORDER BY exposure_start_datetime DESC OFFSET 1 LIMIT 1) AS second_last) LIMIT 1;"}
{"input": "Use the OMOP schema below to write an SQL query for the question. Only print a valid SQL query; do not include any explanations or additional text.\n\nQuestion: \"What was the name of the drug that patient 6425552959618862336 was first prescribed via route 40549429 this month?\"\n\nRelevant Schema:\n-- Schema for table: concept\nconcept.concept_id: Unique concept identifier across vocabularies\nconcept.concept_name: Human-readable name of the concept\nconcept.domain_id: Domain classification (e.g., Condition, Drug, Measurement)\nconcept.vocabulary_id: Vocabulary source (e.g., SNOMED, RxNorm)\n\n-- Schema for table: drug_exposure\ndrug_exposure.drug_exposure_id: Unique ID for the drug exposure record\ndrug_exposure.person_id: Foreign key to person table\ndrug_exposure.drug_concept_id: Concept ID of the prescribed drug\ndrug_exposure.drug_exposure_start_date: Start date of drug exposure\n\n\nSQL:\n", "output": "SELECT concept_name FROM concept WHERE concept_id = (SELECT drug_concept_id FROM (SELECT drug_concept_id FROM drug_exposure WHERE person_id = 6425552959618862336 AND route_concept_id = 40549429 AND exposure_start_date >= DATE_TRUNC('month', CURRENT_DATE) AND drug_concept_id IS NOT NULL ORDER BY exposure_start_datetime ASC LIMIT 1) AS first_prescription) LIMIT 1;"}
{"input": "Use the OMOP schema below to write an SQL query for the question. Only print a valid SQL query; do not include any explanations or additional text.\n\nQuestion: \"What was the name of the drug that patient -6623547836435530117 was at 2127-01-19 13:00:00 prescribed via route 4171047 on the current hospital visit?\"\n\nRelevant Schema:\n-- Schema for table: concept\nconcept.concept_id: Unique concept identifier across vocabularies\nconcept.concept_name: Human-readable name of the concept\nconcept.domain_id: Domain classification (e.g., Condition, Drug, Measurement)\nconcept.vocabulary_id: Vocabulary source (e.g., SNOMED, RxNorm)\n\n-- Schema for table: drug_exposure\ndrug_exposure.drug_exposure_id: Unique ID for the drug exposure record\ndrug_exposure.person_id: Foreign key to person table\ndrug_exposure.drug_concept_id: Concept ID of the prescribed drug\ndrug_exposure.drug_exposure_start_date: Start date of drug exposure\n\n-- Schema for table: visit_occurrence\nvisit_occurrence.visit_occurrence_id: Unique ID for visit record\nvisit_occurrence.person_id: Foreign key to person table\nvisit_occurrence.visit_concept_id: Concept ID for type of visit (e.g., outpatient, inpatient)\nvisit_occurrence.visit_start_date: Date when the visit started\n\n\nSQL:\n", "output": "SELECT concept_name FROM concept WHERE concept_id = (SELECT drug_concept_id FROM drug_exposure WHERE person_id = -6623547836435530117 AND exposure_start_datetime = TIMESTAMP '2127-01-19 13:00:00' AND route_concept_id = 4171047 AND visit_occurrence_id = (SELECT visit_occurrence_id FROM visit_occurrence WHERE person_id = -6623547836435530117 AND visit_start_date <= DATE '2127-01-19' AND visit_end_date >= DATE '2127-01-19' ORDER BY visit_start_date DESC LIMIT 1) AND drug_concept_id IS NOT NULL LIMIT 1) LIMIT 1;"}
{"input": "Use the OMOP schema below to write an SQL query for the question. Only print a valid SQL query; do not include any explanations or additional text.\n\nQuestion: \"What was the name of the specimen that patient -6819106907993465128 was first tested on the first hospital visit?\"\n\nRelevant Schema:\n-- Schema for table: concept\nconcept.concept_id: Unique concept identifier across vocabularies\nconcept.concept_name: Human-readable name of the concept\nconcept.domain_id: Domain classification (e.g., Condition, Drug, Measurement)\nconcept.vocabulary_id: Vocabulary source (e.g., SNOMED, RxNorm)\n\n-- Schema for table: visit_occurrence\nvisit_occurrence.visit_occurrence_id: Unique ID for visit record\nvisit_occurrence.person_id: Foreign key to person table\nvisit_occurrence.visit_concept_id: Concept ID for type of visit (e.g., outpatient, inpatient)\nvisit_occurrence.visit_start_date: Date when the visit started\n\n\nSQL:\n", "output": "SELECT concept_name FROM concept WHERE concept_id = (SELECT specimen_concept_id FROM (SELECT specimen_concept_id FROM specimen WHERE person_id = -6819106907993465128 AND specimen_date BETWEEN (SELECT visit_start_date FROM visit_occurrence WHERE person_id = -6819106907993465128 ORDER BY visit_start_date ASC LIMIT 1) AND (SELECT visit_end_date FROM visit_occurrence WHERE person_id = -6819106907993465128 ORDER BY visit_start_date ASC LIMIT 1) AND specimen_concept_id IS NOT NULL ORDER BY specimen_date, specimen_datetime LIMIT 1) AS first_specimen) LIMIT 1;"}
{"input": "Use the OMOP schema below to write an SQL query for the question. Only print a valid SQL query; do not include any explanations or additional text.\n\nQuestion: \"What was the name of the specimen that patient 4795391738335884256 was first tested on February/13/this year?\"\n\nRelevant Schema:\n-- Schema for table: concept\nconcept.concept_id: Unique concept identifier across vocabularies\nconcept.concept_name: Human-readable name of the concept\nconcept.domain_id: Domain classification (e.g., Condition, Drug, Measurement)\nconcept.vocabulary_id: Vocabulary source (e.g., SNOMED, RxNorm)\n\n\nSQL:\n", "output": "SELECT concept_name FROM concept WHERE concept_id = (SELECT specimen_concept_id FROM (SELECT specimen_concept_id FROM specimen WHERE person_id = 4795391738335884256 AND specimen_date = DATE_TRUNC('year', CURRENT_DATE) + INTERVAL '1 month' * 1 + INTERVAL '12 days' AND specimen_concept_id IS NOT NULL ORDER BY specimen_datetime ASC NULLS LAST, specimen_date ASC LIMIT 1) AS first_specimen) LIMIT 1;"}
{"input": "Use the OMOP schema below to write an SQL query for the question. Only print a valid SQL query; do not include any explanations or additional text.\n\nQuestion: \"What was the name of the specimen that patient 5968818447823462715 was second tested until last month?\"\n\nRelevant Schema:\n-- Schema for table: concept\nconcept.concept_id: Unique concept identifier across vocabularies\nconcept.concept_name: Human-readable name of the concept\nconcept.domain_id: Domain classification (e.g., Condition, Drug, Measurement)\nconcept.vocabulary_id: Vocabulary source (e.g., SNOMED, RxNorm)\n\n\nSQL:\n", "output": "SELECT concept_name FROM concept WHERE concept_id = (SELECT specimen_concept_id FROM (SELECT specimen_concept_id FROM specimen WHERE person_id = 5968818447823462715 AND specimen_date < DATE_TRUNC('month', CURRENT_DATE) AND specimen_concept_id IS NOT NULL ORDER BY specimen_date ASC, specimen_datetime ASC NULLS LAST OFFSET 1 LIMIT 1) AS second_specimen) LIMIT 1;"}
{"input": "Use the OMOP schema below to write an SQL query for the question. Only print a valid SQL query; do not include any explanations or additional text.\n\nQuestion: \"What was the name of the specimen that patient -4766486693575350599 was first tested today?\"\n\nRelevant Schema:\n-- Schema for table: concept\nconcept.concept_id: Unique concept identifier across vocabularies\nconcept.concept_name: Human-readable name of the concept\nconcept.domain_id: Domain classification (e.g., Condition, Drug, Measurement)\nconcept.vocabulary_id: Vocabulary source (e.g., SNOMED, RxNorm)\n\n\nSQL:\n", "output": "SELECT concept_name FROM concept WHERE concept_id = (SELECT specimen_concept_id FROM (SELECT specimen_concept_id FROM specimen WHERE person_id = -4766486693575350599 AND specimen_date = CURRENT_DATE AND specimen_concept_id IS NOT NULL ORDER BY specimen_datetime ASC NULLS LAST, specimen_date ASC LIMIT 1) AS first_specimen) LIMIT 1;"}
{"input": "Use the OMOP schema below to write an SQL query for the question. Only print a valid SQL query; do not include any explanations or additional text.\n\nQuestion: \"What was the name of the specimen that patient 6592787936548515380 was second to last tested last year?\"\n\nRelevant Schema:\n-- Schema for table: concept\nconcept.concept_id: Unique concept identifier across vocabularies\nconcept.concept_name: Human-readable name of the concept\nconcept.domain_id: Domain classification (e.g., Condition, Drug, Measurement)\nconcept.vocabulary_id: Vocabulary source (e.g., SNOMED, RxNorm)\n\n\nSQL:\n", "output": "SELECT concept_name FROM concept WHERE concept_id = (SELECT specimen_concept_id FROM (SELECT specimen_concept_id FROM specimen WHERE person_id = 6592787936548515380 AND specimen_date >= DATE_TRUNC('year', CURRENT_DATE) - INTERVAL '1 year' AND specimen_date < DATE_TRUNC('year', CURRENT_DATE) AND specimen_concept_id IS NOT NULL ORDER BY specimen_date DESC, specimen_datetime DESC NULLS LAST OFFSET 1 LIMIT 1) AS second_to_last_specimen) LIMIT 1;"}
{"input": "Use the OMOP schema below to write an SQL query for the question. Only print a valid SQL query; do not include any explanations or additional text.\n\nQuestion: \"What are the top 5 frequent diagnoses on August/23/2123?\"\n\nRelevant Schema:\n-- Schema for table: concept\nconcept.concept_id: Unique concept identifier across vocabularies\nconcept.concept_name: Human-readable name of the concept\nconcept.domain_id: Domain classification (e.g., Condition, Drug, Measurement)\nconcept.vocabulary_id: Vocabulary source (e.g., SNOMED, RxNorm)\n\n-- Schema for table: condition_occurrence\ncondition_occurrence.condition_occurrence_id: Unique ID for condition record\ncondition_occurrence.person_id: Foreign key to person table\ncondition_occurrence.condition_concept_id: Concept ID for condition\ncondition_occurrence.condition_start_date: Date of condition onset\n\n\nSQL:\n", "output": "SELECT concept_name FROM concept WHERE concept_id IN (SELECT condition_concept_id FROM (SELECT condition_concept_id FROM condition_occurrence WHERE condition_start_date = DATE '2123-08-23' AND condition_concept_id IS NOT NULL GROUP BY condition_concept_id ORDER BY COUNT(*) DESC LIMIT 5) AS top_diagnoses) LIMIT 5;"}
{"input": "Use the OMOP schema below to write an SQL query for the question. Only print a valid SQL query; do not include any explanations or additional text.\n\nQuestion: \"What are the top 3 frequent diagnoses last year?\"\n\nRelevant Schema:\n-- Schema for table: concept\nconcept.concept_id: Unique concept identifier across vocabularies\nconcept.concept_name: Human-readable name of the concept\nconcept.domain_id: Domain classification (e.g., Condition, Drug, Measurement)\nconcept.vocabulary_id: Vocabulary source (e.g., SNOMED, RxNorm)\n\n-- Schema for table: condition_occurrence\ncondition_occurrence.condition_occurrence_id: Unique ID for condition record\ncondition_occurrence.person_id: Foreign key to person table\ncondition_occurrence.condition_concept_id: Concept ID for condition\ncondition_occurrence.condition_start_date: Date of condition onset\n\n\nSQL:\n", "output": "SELECT concept_name FROM concept WHERE concept_id IN (SELECT condition_concept_id FROM (SELECT condition_concept_id FROM condition_occurrence WHERE condition_start_date >= DATE_TRUNC('year', CURRENT_DATE) - INTERVAL '1 year' AND condition_start_date < DATE_TRUNC('year', CURRENT_DATE) AND condition_concept_id IS NOT NULL GROUP BY condition_concept_id ORDER BY COUNT(*) DESC LIMIT 3) AS top_diagnoses) LIMIT 3;"}
{"input": "Use the OMOP schema below to write an SQL query for the question. Only print a valid SQL query; do not include any explanations or additional text.\n\nQuestion: \"What are the top 5 frequent diagnoses on the first hospital visit?\"\n\nRelevant Schema:\n-- Schema for table: concept\nconcept.concept_id: Unique concept identifier across vocabularies\nconcept.concept_name: Human-readable name of the concept\nconcept.domain_id: Domain classification (e.g., Condition, Drug, Measurement)\nconcept.vocabulary_id: Vocabulary source (e.g., SNOMED, RxNorm)\n\n-- Schema for table: condition_occurrence\ncondition_occurrence.condition_occurrence_id: Unique ID for condition record\ncondition_occurrence.person_id: Foreign key to person table\ncondition_occurrence.condition_concept_id: Concept ID for condition\ncondition_occurrence.condition_start_date: Date of condition onset\n\n-- Schema for table: visit_occurrence\nvisit_occurrence.visit_occurrence_id: Unique ID for visit record\nvisit_occurrence.person_id: Foreign key to person table\nvisit_occurrence.visit_concept_id: Concept ID for type of visit (e.g., outpatient, inpatient)\nvisit_occurrence.visit_start_date: Date when the visit started\n\n\nSQL:\n", "output": "SELECT concept_name FROM concept WHERE concept_id IN (SELECT condition_concept_id FROM (SELECT condition_concept_id FROM condition_occurrence WHERE visit_occurrence_id = (SELECT visit_occurrence_id FROM visit_occurrence WHERE person_id = condition_occurrence.person_id ORDER BY visit_start_date ASC LIMIT 1) AND condition_concept_id IS NOT NULL GROUP BY condition_concept_id ORDER BY COUNT(*) DESC LIMIT 5) AS top_diagnoses_first_visit) LIMIT 5;"}
{"input": "Use the OMOP schema below to write an SQL query for the question. Only print a valid SQL query; do not include any explanations or additional text.\n\nQuestion: \"What are the top 4 frequent diagnoses since last month?\"\n\nRelevant Schema:\n-- Schema for table: concept\nconcept.concept_id: Unique concept identifier across vocabularies\nconcept.concept_name: Human-readable name of the concept\nconcept.domain_id: Domain classification (e.g., Condition, Drug, Measurement)\nconcept.vocabulary_id: Vocabulary source (e.g., SNOMED, RxNorm)\n\n-- Schema for table: condition_occurrence\ncondition_occurrence.condition_occurrence_id: Unique ID for condition record\ncondition_occurrence.person_id: Foreign key to person table\ncondition_occurrence.condition_concept_id: Concept ID for condition\ncondition_occurrence.condition_start_date: Date of condition onset\n\n\nSQL:\n", "output": "SELECT concept_name FROM concept WHERE concept_id IN (SELECT condition_concept_id FROM (SELECT condition_concept_id FROM condition_occurrence WHERE condition_start_date >= (DATE_TRUNC('month', CURRENT_DATE) - INTERVAL '1 month') AND condition_concept_id IS NOT NULL GROUP BY condition_concept_id ORDER BY COUNT(*) DESC LIMIT 4) AS top_diagnoses_last_month) LIMIT 4;"}
{"input": "Use the OMOP schema below to write an SQL query for the question. Only print a valid SQL query; do not include any explanations or additional text.\n\nQuestion: \"What are the top 4 frequent diagnoses in 2178?\"\n\nRelevant Schema:\n-- Schema for table: concept\nconcept.concept_id: Unique concept identifier across vocabularies\nconcept.concept_name: Human-readable name of the concept\nconcept.domain_id: Domain classification (e.g., Condition, Drug, Measurement)\nconcept.vocabulary_id: Vocabulary source (e.g., SNOMED, RxNorm)\n\n-- Schema for table: condition_occurrence\ncondition_occurrence.condition_occurrence_id: Unique ID for condition record\ncondition_occurrence.person_id: Foreign key to person table\ncondition_occurrence.condition_concept_id: Concept ID for condition\ncondition_occurrence.condition_start_date: Date of condition onset\n\n\nSQL:\n", "output": "SELECT concept_name FROM concept WHERE concept_id IN (SELECT condition_concept_id FROM (SELECT condition_concept_id FROM condition_occurrence WHERE condition_start_date >= DATE '2178-01-01' AND condition_start_date < DATE '2179-01-01' AND condition_concept_id IS NOT NULL GROUP BY condition_concept_id ORDER BY COUNT(*) DESC LIMIT 4) AS top_diagnoses_2178) LIMIT 4;"}
{"input": "Use the OMOP schema below to write an SQL query for the question. Only print a valid SQL query; do not include any explanations or additional text.\n\nQuestion: \"What was the second measured weight of patient 1922226694437355804 on July/16/last year?\"\n\nRelevant Schema:\n-- Schema for table: measurement\nmeasurement.measurement_id: Unique ID for measurement record\nmeasurement.person_id: Foreign key to person table\nmeasurement.measurement_concept_id: Concept ID for the measurement (e.g., blood pressure)\nmeasurement.measurement_date: Date of the measurement\n\n\nSQL:\n", "output": "SELECT value_as_number FROM (SELECT value_as_number FROM measurement WHERE person_id = 1922226694437355804 AND measurement_concept_id = 3025315 AND measurement_date = (DATE_TRUNC('year', CURRENT_DATE) - INTERVAL '1 year') + INTERVAL '6 months' + INTERVAL '15 days' AND value_as_number IS NOT NULL ORDER BY measurement_datetime ASC NULLS LAST, measurement_id ASC OFFSET 1 LIMIT 1) AS second_weight LIMIT 1;"}
{"input": "Use the OMOP schema below to write an SQL query for the question. Only print a valid SQL query; do not include any explanations or additional text.\n\nQuestion: \"What was the first measured weight of patient -5137371837600014318 since yesterday?\"\n\nRelevant Schema:\n-- Schema for table: measurement\nmeasurement.measurement_id: Unique ID for measurement record\nmeasurement.person_id: Foreign key to person table\nmeasurement.measurement_concept_id: Concept ID for the measurement (e.g., blood pressure)\nmeasurement.measurement_date: Date of the measurement\n\n\nSQL:\n", "output": "SELECT value_as_number FROM (SELECT value_as_number FROM measurement WHERE person_id = -5137371837600014318 AND measurement_concept_id = 3025315 AND measurement_date >= CURRENT_DATE - INTERVAL '1 day' AND value_as_number IS NOT NULL ORDER BY measurement_datetime ASC NULLS LAST, measurement_id ASC LIMIT 1) AS first_weight LIMIT 1;"}
{"input": "Use the OMOP schema below to write an SQL query for the question. Only print a valid SQL query; do not include any explanations or additional text.\n\nQuestion: \"What was the second to last measured weight of patient -377874305776176554 on the first hospital visit?\"\n\nRelevant Schema:\n-- Schema for table: measurement\nmeasurement.measurement_id: Unique ID for measurement record\nmeasurement.person_id: Foreign key to person table\nmeasurement.measurement_concept_id: Concept ID for the measurement (e.g., blood pressure)\nmeasurement.measurement_date: Date of the measurement\n\n-- Schema for table: visit_occurrence\nvisit_occurrence.visit_occurrence_id: Unique ID for visit record\nvisit_occurrence.person_id: Foreign key to person table\nvisit_occurrence.visit_concept_id: Concept ID for type of visit (e.g., outpatient, inpatient)\nvisit_occurrence.visit_start_date: Date when the visit started\n\n\nSQL:\n", "output": "SELECT value_as_number FROM (SELECT value_as_number FROM measurement WHERE person_id = -377874305776176554 AND measurement_concept_id = 3025315 AND visit_occurrence_id = (SELECT visit_occurrence_id FROM visit_occurrence WHERE person_id = -377874305776176554 ORDER BY visit_start_date ASC LIMIT 1) AND value_as_number IS NOT NULL ORDER BY measurement_datetime DESC NULLS LAST, measurement_id DESC OFFSET 1 LIMIT 1) AS second_to_last_weight LIMIT 1;"}
{"input": "Use the OMOP schema below to write an SQL query for the question. Only print a valid SQL query; do not include any explanations or additional text.\n\nQuestion: \"What was the last measured weight of patient 4140836990585633885 since last year?\"\n\nRelevant Schema:\n-- Schema for table: measurement\nmeasurement.measurement_id: Unique ID for measurement record\nmeasurement.person_id: Foreign key to person table\nmeasurement.measurement_concept_id: Concept ID for the measurement (e.g., blood pressure)\nmeasurement.measurement_date: Date of the measurement\n\n\nSQL:\n", "output": "SELECT value_as_number FROM (SELECT value_as_number FROM measurement WHERE person_id = 4140836990585633885 AND measurement_concept_id = 3025315 AND measurement_date >= DATE_TRUNC('year', CURRENT_DATE) - INTERVAL '1 year' AND value_as_number IS NOT NULL ORDER BY measurement_datetime DESC NULLS LAST, measurement_id DESC LIMIT 1) AS last_weight LIMIT 1;"}
{"input": "Use the OMOP schema below to write an SQL query for the question. Only print a valid SQL query; do not include any explanations or additional text.\n\nQuestion: \"What was the last measured weight of patient 6760981801117359828 until last month?\"\n\nRelevant Schema:\n-- Schema for table: measurement\nmeasurement.measurement_id: Unique ID for measurement record\nmeasurement.person_id: Foreign key to person table\nmeasurement.measurement_concept_id: Concept ID for the measurement (e.g., blood pressure)\nmeasurement.measurement_date: Date of the measurement\n\n\nSQL:\n", "output": "SELECT value_as_number FROM (SELECT value_as_number FROM measurement WHERE person_id = 6760981801117359828 AND measurement_concept_id = 3025315 AND measurement_date < DATE_TRUNC('month', CURRENT_DATE) AND value_as_number IS NOT NULL ORDER BY measurement_datetime DESC NULLS LAST, measurement_id DESC LIMIT 1) AS last_weight LIMIT 1;"}
{"input": "Use the OMOP schema below to write an SQL query for the question. Only print a valid SQL query; do not include any explanations or additional text.\n\nQuestion: \"Count the number of patients who were dead after having been diagnosed with 438120 within the same day since 7 month ago.\"\n\nRelevant Schema:\n-- Schema for table: condition_occurrence\ncondition_occurrence.condition_occurrence_id: Unique ID for condition record\ncondition_occurrence.person_id: Foreign key to person table\ncondition_occurrence.condition_concept_id: Concept ID for condition\ncondition_occurrence.condition_start_date: Date of condition onset\n\n\nSQL:\n", "output": "SELECT COUNT(DISTINCT c.person_id) FROM (SELECT c.person_id FROM condition_occurrence c WHERE c.condition_concept_id = 438120 AND c.condition_start_date >= CURRENT_DATE - INTERVAL '7 month' AND c.person_id IN (SELECT d.person_id FROM death d WHERE d.death_date = c.condition_start_date)) AS patients_dead_same_day;"}
{"input": "Use the OMOP schema below to write an SQL query for the question. Only print a valid SQL query; do not include any explanations or additional text.\n\nQuestion: \"Count the number of patients who were dead after having been diagnosed with 432881 within the same hospital visit until 2198.\"\n\nRelevant Schema:\n-- Schema for table: condition_occurrence\ncondition_occurrence.condition_occurrence_id: Unique ID for condition record\ncondition_occurrence.person_id: Foreign key to person table\ncondition_occurrence.condition_concept_id: Concept ID for condition\ncondition_occurrence.condition_start_date: Date of condition onset\n\n-- Schema for table: visit_occurrence\nvisit_occurrence.visit_occurrence_id: Unique ID for visit record\nvisit_occurrence.person_id: Foreign key to person table\nvisit_occurrence.visit_concept_id: Concept ID for type of visit (e.g., outpatient, inpatient)\nvisit_occurrence.visit_start_date: Date when the visit started\n\n\nSQL:\n", "output": "SELECT COUNT(DISTINCT c.person_id) FROM (SELECT c.person_id FROM condition_occurrence c WHERE c.condition_concept_id = 432881 AND c.condition_start_date < DATE '2199-01-01' AND c.visit_occurrence_id IS NOT NULL AND c.person_id IN (SELECT d.person_id FROM death d WHERE d.death_date BETWEEN (SELECT v.visit_start_date FROM visit_occurrence v WHERE v.visit_occurrence_id = c.visit_occurrence_id LIMIT 1) AND (SELECT v.visit_end_date FROM visit_occurrence v WHERE v.visit_occurrence_id = c.visit_occurrence_id LIMIT 1))) AS patients_dead_same_visit;"}
{"input": "Use the OMOP schema below to write an SQL query for the question. Only print a valid SQL query; do not include any explanations or additional text.\n\nQuestion: \"Count the number of patients who were dead after having been diagnosed with 378419 within the same ICU visit yesterday.\"\n\nRelevant Schema:\n-- Schema for table: condition_occurrence\ncondition_occurrence.condition_occurrence_id: Unique ID for condition record\ncondition_occurrence.person_id: Foreign key to person table\ncondition_occurrence.condition_concept_id: Concept ID for condition\ncondition_occurrence.condition_start_date: Date of condition onset\n\n\nSQL:\n", "output": "SELECT COUNT(DISTINCT person_id) FROM (SELECT c.person_id FROM condition_occurrence c WHERE c.condition_concept_id = 378419 AND c.visit_detail_id IN (SELECT v.visit_detail_id FROM visit_detail v WHERE v.person_id = c.person_id AND v.visit_detail_concept_id = 32037 AND v.visit_detail_start_date = CURRENT_DATE - INTERVAL '1 day') AND c.person_id IN (SELECT d.person_id FROM death d WHERE d.death_date BETWEEN (SELECT v.visit_detail_start_date FROM visit_detail v WHERE v.visit_detail_id = c.visit_detail_id LIMIT 1) AND (SELECT v.visit_detail_end_date FROM visit_detail v WHERE v.visit_detail_id = c.visit_detail_id LIMIT 1))) AS patients_dead_same_icu_visit;"}
{"input": "Use the OMOP schema below to write an SQL query for the question. Only print a valid SQL query; do not include any explanations or additional text.\n\nQuestion: \"Count the number of patients who were dead after having been diagnosed with 254061 at the same time on the last hospital visit\"\n\nRelevant Schema:\n-- Schema for table: condition_occurrence\ncondition_occurrence.condition_occurrence_id: Unique ID for condition record\ncondition_occurrence.person_id: Foreign key to person table\ncondition_occurrence.condition_concept_id: Concept ID for condition\ncondition_occurrence.condition_start_date: Date of condition onset\n\n-- Schema for table: visit_occurrence\nvisit_occurrence.visit_occurrence_id: Unique ID for visit record\nvisit_occurrence.person_id: Foreign key to person table\nvisit_occurrence.visit_concept_id: Concept ID for type of visit (e.g., outpatient, inpatient)\nvisit_occurrence.visit_start_date: Date when the visit started\n\n\nSQL:\n", "output": "SELECT COUNT(DISTINCT person_id) FROM (SELECT c.person_id FROM condition_occurrence c WHERE c.condition_concept_id = 254061 AND c.visit_occurrence_id = (SELECT v.visit_occurrence_id FROM visit_occurrence v WHERE v.person_id = c.person_id ORDER BY v.visit_start_date DESC LIMIT 1) AND c.person_id IN (SELECT d.person_id FROM death d WHERE d.death_date > c.condition_start_date AND d.death_date BETWEEN (SELECT v.visit_start_date FROM visit_occurrence v WHERE v.visit_occurrence_id = c.visit_occurrence_id LIMIT 1) AND (SELECT v.visit_end_date FROM visit_occurrence v WHERE v.visit_occurrence_id = c.visit_occurrence_id LIMIT 1))) AS patients_dead_after_diag_same_visit;"}
{"input": "Use the OMOP schema below to write an SQL query for the question. Only print a valid SQL query; do not include any explanations or additional text.\n\nQuestion: \"Count the number of patients who were dead after having been diagnosed with 437246 within 10 year until last year.\"\n\nRelevant Schema:\n-- Schema for table: condition_occurrence\ncondition_occurrence.condition_occurrence_id: Unique ID for condition record\ncondition_occurrence.person_id: Foreign key to person table\ncondition_occurrence.condition_concept_id: Concept ID for condition\ncondition_occurrence.condition_start_date: Date of condition onset\n\n\nSQL:\n", "output": "SELECT COUNT(DISTINCT person_id) AS num_dead_patients FROM death WHERE person_id IN (SELECT person_id FROM condition_occurrence WHERE condition_concept_id = 437246 AND condition_start_date <= (DATE_TRUNC('year', CURRENT_DATE) - INTERVAL '1 day')) AND death_date <= (DATE_TRUNC('year', CURRENT_DATE) - INTERVAL '1 day') AND death_date >= (SELECT MIN(condition_start_date) FROM condition_occurrence co WHERE co.person_id = death.person_id AND co.condition_concept_id = 437246) AND death_date <= (SELECT MIN(condition_start_date) FROM condition_occurrence co WHERE co.person_id = death.person_id AND co.condition_concept_id = 437246) + INTERVAL '10 year';"}
